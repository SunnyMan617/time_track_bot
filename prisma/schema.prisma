// Prisma schema for Time Tracking Bot

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  telegramId    BigInt    @unique
  username      String?
  firstName     String?
  lastName      String?
  languageCode  String?
  isPremium     Boolean   @default(false)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  tasks         Task[]
  timeEntries   TimeEntry[]
  projects      Project[]
  settings      UserSettings?

  @@index([telegramId])
}

model UserSettings {
  id                String   @id @default(cuid())
  userId            String   @unique
  timezone          String   @default("UTC")
  workHoursPerDay   Int      @default(8)
  startOfWeek       Int      @default(1) // 1 = Monday
  dateFormat        String   @default("DD/MM/YYYY")
  timeFormat        String   @default("24h")
  notifications     Boolean  @default(true)
  dailyReminder     Boolean  @default(false)
  reminderTime      String?  // HH:MM format
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Project {
  id          String   @id @default(cuid())
  name        String
  description String?
  color       String   @default("#3B82F6")
  isArchived  Boolean  @default(false)
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tasks       Task[]
  timeEntries TimeEntry[]

  @@index([userId])
  @@index([userId, isArchived])
}

model Task {
  id          String    @id @default(cuid())
  title       String
  description String?
  status      String    @default("TODO") // TODO, IN_PROGRESS, DONE, CANCELLED
  priority    String    @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  projectId   String?
  userId      String
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  project     Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  timeEntries TimeEntry[]

  @@index([userId])
  @@index([userId, status])
  @@index([projectId])
}

model TimeEntry {
  id          String    @id @default(cuid())
  description String?
  startTime   DateTime
  endTime     DateTime?
  duration    Int?      // in seconds
  userId      String
  taskId      String?
  projectId   String?
  isManual    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  task        Task?     @relation(fields: [taskId], references: [id], onDelete: SetNull)
  project     Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([userId, startTime])
  @@index([taskId])
  @@index([projectId])
}

// Note: Using String instead of enum for SQLite compatibility
// TaskStatus: TODO, IN_PROGRESS, DONE, CANCELLED
// Priority: LOW, MEDIUM, HIGH, URGENT

